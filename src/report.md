# Simple Docker

Введение в докер. Разработка простого докер образа для собственного сервера.


## Содержание

1. [Готовый докер](#1-готовый-докер)
2. [Операции с контейнером](#p2-операции-с-контейнером)
3. [Мини веб-сервер](#3-мини-веб-сервер)
4. [Свой докер](#4-свой-докер)
5. [Dockle](#5-инструмент-dockle)
6. [Базовый Docker Compose](#6-базовый-docker-compose)


## 1. Готовый докер

##### Скачивание официального докер образа с **nginx** при помощи `docker pull`

![part1](/src/misc/images/part1_1.png)
>Рисунок 1. Результат выполнения команды docker pull

##### Проверка наличия докер образа через `docker images`

![part1](/src/misc/images/part1_2.png)
>Рисунок 2. Результат выполнения команды docker images

##### Запуск докер образа через `docker run -d [image_id|repository]`

![part1](/src/misc/images/part1_3.png)
>Рисунок 3. Результат выполнения команды docker run -d

##### Провека запуска образа через `docker ps`

![part1](/src/misc/images/part1_4.png)
>Рисунок 4. Результат выполнения команды docker ps

##### Просмотр информации о контейнере через `docker inspect [container_id|container_name]`

![part1](/src/misc/images/part1_5.png)
>Рисунок 5. Фрагмент результата выполнения команды docker inspect

размер контейнера: 67108864\
список замапленных портов: 80/tcp\
ip контейнера: 172.17.0.2

##### Остановка докер образ через `docker stop [container_id|container_name]`

![part1](/src/misc/images/part1_6.png)
>Рисунок 6. Результат выполнения команды docker stop

##### Проверка остановки образа через `docker ps`

![part1](/src/misc/images/part1_7.png)
>Рисунок 7. Результат выполнения команды docker ps

##### Запуск докера с портами 80 и 443 в контейнере, замапленными на такие же порты на локальной машине, через команду *run*

![part1](/src/misc/images/part1_8.png)
>Рисунок 8. Результат выполнения команды run

##### Проверка в браузере по адресу *localhost:80* доступность стартовой страницы **nginx**

![part1](/src/misc/images/part1_9.png)
>Рисунок 9. Проверка доступности стартовой страницы

##### Перезапуск докер контейнера через `docker restart [container_id|container_name]`

![part1](/src/misc/images/part1_10.png)
>Рисунок 10. Результат выполнения команды docker restart

##### Проверка запуска контейнера

![part1](/src/misc/images/part1_11.png)
>Рисунок 11. Результат проверки работоспособности конетйнера

## 2. Операции с контейнером

##### Чтение конфигурационного файла *nginx.conf* внутри докер контейнера через команду *exec*

![part2](/src/misc/images/part2_1.png)
>Рисунок 12. Результат выполнения команды exec

##### Создание на локальной машине файла *nginx.conf*

![part2](/src/misc/images/part2_2.png)
>Рисунок 13. Созданный файл *nginx.conf*

##### Настроика в нем по пути */status* отдачи страницы статуса сервера **nginx**

![part2](/src/misc/images/part2_3.png)
>Рисунок 14. Настройка отдачи страницы статуса

##### Скопировать созданный файл *nginx.conf* внутрь докер образа через команду `docker cp`

![part2](/src/misc/images/part2_4.png)
>Рисунок 15. Результат выполнения команды docker cp

##### Перезапуск **nginx** внутри докер образа через команду *exec*

![part2](/src/misc/images/part2_5.png)
>Рисунок 16. Результат перезапуска nginx

##### Проверка, что по адресу *localhost:80/status* отдается страничка со статусом сервера **nginx**

![part2](/src/misc/images/part2_6.png)
>Рисунок 17. Результат проверки

##### Экспорт контейнера в файл *container.tar* через команду *export*

![part2](/src/misc/images/part2_7.png)
>Рисунок 18. Результат экспортирования контейнера

##### Остановка контейнера

![part2](/src/misc/images/part2_8.png)
>Рисунок 19. Результат выполнения команды docker stop

##### Удаление образа через `docker rmi [image_id|repository]`, без удаления перед этим контейнера

![part2](/src/misc/images/part2_9.png)
>Рисунок 20. Результат выполнения команды docker rmi

##### Удаление остановленного контейнера

![part2](/src/misc/images/part2_10.png)
>Рисунок 21. Удаление остановленного контейнера

##### Импортирование контейнера обратно через команду *import*

![part2](/src/misc/images/part2_11.png)
>Рисунок 22. Результат выполнения команды import

##### Запуск импортированного контейнера

![part2](/src/misc/images/part2_12.png)
>Рисунок 23. Запуск импортированного контейнера

##### Проверка адреса *localhost:80/status*

![part2](/src/misc/images/part2_13.png)
>Рисунок 24. Проверка доступности страницы со статусом сервера

## 3. Мини веб-сервер

##### Написание мини сервера на **C** и **FastCgi**, возвращающего страницу с надписью `Hello World!`

![part3](/src/misc/images/part3_1.png)
>Рисунок 25. Исходный код сервера

##### Написание *nginx.conf*, проксирующий все запросы с 81 порта на *127.0.0.1:8080*

![part3](/src/misc/images/part3_2.png)
>Рисунок 26. Исходный код nginx.conf

##### Запуск мини сервера через *spawn-fcgi* на порту 8080

![part3](/src/misc/images/part3_3.png)
>Рисунок 27. Запуск контейнера с проксированием на 81 порт

![part3](/src/misc/images/part3_4.png)
>Рисунок 28. Копирование файлов сервера

![part3](/src/misc/images/part3_5.png)
>Рисунок 29. Обновление репозиториев в контейнере

![part3](/src/misc/images/part3_6.png)
>Рисунок 30. Перезапуск nginx'a в контейнере

![part3](/src/misc/images/part3_7.png)
>Рисунок 31. Компиляция и запуск сервера на порту 8080

##### Проверка, что в браузере по *localhost:81* отдается страница с надписью `Hello World!`

![part3](/src/misc/images/part3_8.png)
>Рисунок 32. Результат запроса по адресу localhost:81

##### Создание файла *nginx.conf* по пути *./nginx/nginx.conf*

![part3](/src/misc/images/part3_9.png)
>Рисунок 33. Расположение файла nginx.conf

## 4. Свой докер

#### Написание докер образа, который:
##### 1) собирает исходники мини сервера на FastCgi из [Части 3](#3-мини-веб-сервер)
##### 2) запускает его на 8080 порту
##### 3) копирует внутрь образа написанный *./nginx/nginx.conf*
##### 4) запускает **nginx**.

##### Сборка докер образа через `docker build` с именем septicge и тегом 0.1

![part4](/src/misc/images/part4_1.png)
>Рисунок 34. Результат выполнения команды docker build

##### Проверка корректности сборки через `docker images`

![part4](/src/misc/images/part4_2.png)
>Рисунок 35. Результат выполнения команды docker images

##### Запуск собранного докер образа с маппингом 81 порта на 80 на локальной машине и маппингом папки *./nginx* внутрь контейнера по адресу, где лежат конфигурационные файлы **nginx**'а

![part4](/src/misc/images/part4_3.png)
>Рисунок 36. Запуск докер образа

##### Проверка доступности страницы сервера по localhost:80

![part4](/src/misc/images/part4_4.png)
>Рисунок 37. Результат запроса по адресу localhost:80

##### Добавление в *./nginx/nginx.conf* проксирование странички */status*, по которой отдается статус сервера **nginx**

![part4](/src/misc/images/part4_5.png)
>Рисунок 38. Исходный код nginx.conf в папке src

![part4](/src/misc/images/part4_6.png)
>Рисунок 38. Исходный код nginx.conf в конетйнере

##### Пересборка контейнера с учетом изменений конфигурации nginx

![part4](/src/misc/images/part4_7.png)
>Рисунок 39. Пересборка контейнера

##### Проверка доступности страницы со статусом **nginx** по адресу *localhost:80/status*

![part4](/src/misc/images/part4_8.png)
>Рисунок 40. Результат запроса по адресу localhost:80/status

## 5. Инструмент **Dockle**

##### Сканирование последней версии образа из предыдущего задания через `dockle [image_id|repository]`

![part5](/src/misc/images/part5_1.png)
>Рисунок 41. Результат сканирования исходного образа

##### Исправить образ так, чтобы при проверке через **dockle** не было ошибок и предупреждений

![part5](/src/misc/images/part5_2.png)
>Рисунок 42. Результат сканирования исправленного образа

![part5](/src/misc/images/part5_3.png)
>Рисунок 43. Результат запроса по адресу localhost:80 и localhost:80/status

## 6. Базовый **Docker Compose**

#### Написание файла *docker-compose.yml*, с помощью которого:
##### 1) Поднимается докер контейнер из [Части 5](#5-инструмент-dockle)
##### 2) Поднимается докер контейнер с **nginx**, проксирующий все запросы с 8080 порта на 81 порт первого контейнера
##### 3) Мапится 8080 порт второго контейнера на 80 порт локальной машины

##### Остановка всех запущенных контейнеров

![part6](/src/misc/images/part6_1.png)
>Рисунок 44. Остановка и проверка

##### Сборка и запуск проекта с помощью команд `docker-compose build` и `docker-compose up`

![part6](/src/misc/images/part6_2.png)
>Рисунок 45. Результат сборки и запуска

##### Проверить, что в браузере по *localhost:80* отдается написанная вами страничка, как и ранее

![part6](/src/misc/images/part6_3.png)
>Рисунок 46. Результат запроса по адресу localhost:80 и localhost:80/status
